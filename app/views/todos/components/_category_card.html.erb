<div class="bg-emerald-100 rounded-lg p-4 cursor-pointer" onclick="openCategoryModal(event, <%= category.id %>)">
  <h2 class="text-xl font-bold mb-4"><%= category.name %></h2>
  <div class="space-y-2 checkboxesToDuplicate">
    <% category.items.incomplete.each do |item| %>
      <div class="flex items-center gap-2 incompleteTask" id="task-<%= item.id %>">
        <input type="checkbox" onclick="updateItem(<%= item.id %>, <%= !item.completed? %>)"> <span><%= item.name %></span>
      </div>
    <% end %>
    <% category.items.completed.each do |item| %>
      <div class="flex items-center gap-2 completedTask" id="task-<%= item.id %>">
        <input type="checkbox" checked disabled onclick="updateItem(<%= item.id %>, <%= item.completed? %>)"> <span class="line-through"><%= item.name %></span>
      </div>
    <% end %>
  </div>
</div>

<script>
  function updateItem(itemId, completed) {
    fetch(`categories/<%= category.id %>/items/${itemId}`, {
      method: "PUT",
      headers: {
        "X-CSRF-Token": "<%= form_authenticity_token %>",
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        completed,
        hush_key: "<%= @user.hush_key %>"
      })
    }).then(response => response.json()).then(data => {
      if (data.completed) {
        document.getElementById(`task-${itemId}`).innerHTML = `<input type="checkbox" checked disabled onclick="updateItem(${itemId}, ${!data.completed})"> <span class="line-through">${data.name}</span>`;
      } else {
        document.getElementById(`task-${itemId}`).innerHTML = `<input type="checkbox" onclick="updateItem(${itemId}, ${!data.completed})"> <span>${data.name}</span>`;
      }
    })
  }
</script>
